import{i as j,j as u,G as U,k as _,l as c,o as l,c as b,w as n,a as s,e as a,h as g,b as d,t as m,g as w,F as V,f as p}from"./app-2a871929.js";import{C as D}from"./Ckeditor-fd58bb26.js";import{_ as P}from"./_plugin-vue_export-helper-c27b6911.js";const T={components:{Link:j,CkeditorPost:D},data(){return{id:"",dialogVisible:!1,imageSelected:"",dataForm:{},listHagTag:[],listCategory:"",categorySelect:"",errors:[]}},watch:{dialogVisible(i){i==!1&&this.clearResult()}},methods:{clearResult(){this.imageSelected="",this.imageSelected="",this.$refs.file="",this.dataForm="",this.$refs.content.editorData="",this.categorySelect="",this.listCategory="",this.listHagTag=[],this.errors=[]},async open(i){this.id=i,this.dialogVisible=!0,this.fetchData()},async fetchData(){await u.get(route("creator.posts.show",this.id)).then(i=>{this.dataForm=i.data.data,this.$refs.content.editorData=i.data.data.content}).catch(i=>{}),await u.get(route("list-hagtag")).then(i=>{this.listHagTag=i.data}).catch(i=>{})},cancel(){this.dialogVisible=!1},async changeImage(i){try{const t=i.target.files||i.dataTransfer.files;if(!t.length)return;if(t[0].size>5*1024*1024)return this.$message.warning(this.$i18n.t("File quá lớn, dung lượng tối đa cho phép 5MB")),!1;const x=t[0].name.substring(t[0].name.lastIndexOf(".")),h=[".png",".bmp",".jpeg",".tif",".gif",".jpg"];if(!h.find(e=>e===x))return this.$message.warning(this.$i18n.t("File sai định dạng. Cần thuộc các định dạng sau: ")+h.join(", ")),!1;this.dataForm.image=t[0],this.imageSelected=URL.createObjectURL(t[0])}catch(t){console.log("handleUploadContent",t)}},findCategory(){const i=U.service({lock:!0,text:"Đang tiến hành phân loại",background:"rgba(0, 0, 0, 0.7)"}),t=new FormData,x=this.$refs.content.editorData.replace(/(<([^>]+)>)/gi,"").replace(/&nbsp;/gi,"");t.append("content",x),u.post("http://127.0.0.1:5000/classify",t).then(h=>{this.listCategory=h.data,i.close()})},async editPost(){const i=new FormData;i.append("title",this.dataForm.title??""),i.append("description",this.dataForm.description??""),i.append("image",this.dataForm.image??""),i.append("content",this.$refs.content.editorData??""),i.append("hagtags",this.dataForm.hagtags??""),i.append("category",this.categorySelect),i.append("is_notice",this.dataForm.is_notice),await u.post(route("creator.posts.update",this.dataForm.id),i).then(t=>{t.data.status==!1?_({showClose:!0,message:t.data.msg,type:"error"}):(_({showClose:!0,message:"Cập nhật bài viết thành công",type:"success"}),this.dialogVisible=!1,this.$emit("change-post"))}).catch(t=>{_({showClose:!0,message:"Vui lòng kiểm tra lại dữ liệu nhập",type:"error"}),this.errors=t.response.data.errors})}}},H=s("div",{class:"text-center font-bold text-[18px]"}," Chỉnh sửa bài viết ",-1),N={class:"mx-[4px] mt-[42px]"},z={class:"mt-[18px] w-[100%]"},B=s("div",{class:"text-[16px] font-bold text-[#000]"},[p("Tiêu đề "),s("span",{class:"text-[red]"},"*")],-1),E={key:0,class:"mt-[5px] text-[#ff0000]"},L={class:"mt-[18px] w-[100%]"},I=s("div",{class:"text-[16px] font-bold text-[#000]"},"Mô tả ",-1),R={key:0,class:"mt-[5px] text-[#ff0000]"},M={class:"mt-[18px]"},q=s("div",{class:"text-[16px] font-bold text-[#000]"},"Hagtag",-1),G={class:"mt-[18px]"},K=s("div",{class:"text-[16px] font-bold text-[#000] mb-[8px]"},"Thông báo",-1),O={class:"mt-[18px] w-[100%]"},X=s("div",{class:"text-[16px] font-bold text-[#000]"},[p("Hình ảnh "),s("span",{class:"text-[red]"},"*")],-1),A={class:"w-[280px] mt-[8px]"},J=["src"],Q=["src"],W=s("i",{class:"bi bi-upload text-lg mr-[8px] text-white"},null,-1),Y={key:0,class:"mt-[5px] text-[#ff0000]"},Z={class:"mt-[18px] w-[100%]"},$=s("div",{class:"text-[16px] font-bold text-[#000]"},[p("Nội dung "),s("span",{class:"text-[red]"},"*")],-1),tt={key:0,class:"mt-[5px] text-[#ff0000]"},et={key:0,class:"mt-[18px]"},st=s("div",{class:"text-[16px] font-bold text-[#000]"},"Kết quả phân loại",-1),ot={class:"mt-[6px] mx-[12px]"},it={class:"font-bold"},lt={class:"font-bold"},at={class:"pb-[12px] pt-[8px]"},nt={class:"flex justify-end text-[14px] mr-[24px]"};function rt(i,t,x,h,e,r){const y=c("el-input"),F=c("el-option"),C=c("el-select"),f=c("el-radio"),v=c("el-radio-group"),k=c("ckeditor-post"),S=c("el-dialog");return l(),b(S,{modelValue:e.dialogVisible,"onUpdate:modelValue":t[10]||(t[10]=o=>e.dialogVisible=o),id:"edit-post",class:"bg-[#f4f1f8] max-h-[95%] overflow-y-scroll",width:"900px",style:{"margin-top":"14px !important"},"show-close":!0},{header:n(()=>[H]),footer:n(()=>[s("div",at,[s("div",nt,[s("div",{onClick:t[7]||(t[7]=(...o)=>r.cancel&&r.cancel(...o)),class:"cursor-pointer flex justify-center items-center w-[110px] rounded-[4px] bg-[#ffffff] py-[4px] h-[32px] text-[15px] text-black border border-[#7d7f92]"}," Hủy bỏ "),s("div",{class:"cursor-pointer flex justify-center items-center w-[110px] ml-[18px] rounded-[4px] bg-[#007bff] py-[4px] h-[32px] text-[15px] text-white",onClick:t[8]||(t[8]=(...o)=>r.findCategory&&r.findCategory(...o))}," Phân loại "),e.categorySelect?(l(),a("div",{key:0,class:"cursor-pointer flex justify-center items-center w-[110px] ml-[18px] rounded-[4px] bg-[#007bff] py-[4px] h-[32px] text-[15px] text-white",onClick:t[9]||(t[9]=(...o)=>r.editPost&&r.editPost(...o))}," Xác nhận ")):g("",!0)])])]),default:n(()=>[s("div",N,[s("div",z,[B,d(y,{class:"mt-[2px]",modelValue:e.dataForm.title,"onUpdate:modelValue":t[0]||(t[0]=o=>e.dataForm.title=o),placeholder:"Nhập tiêu đề",clearable:""},null,8,["modelValue"]),e.errors.title?(l(),a("div",E,m(e.errors.title[0]),1)):g("",!0)]),s("div",L,[I,d(y,{class:"mt-[2px]",modelValue:e.dataForm.description,"onUpdate:modelValue":t[1]||(t[1]=o=>e.dataForm.description=o),placeholder:"Nhập mô tả",clearable:""},null,8,["modelValue"]),e.errors.description?(l(),a("div",R,m(e.errors.description[0]),1)):g("",!0)]),s("div",M,[q,d(C,{modelValue:e.dataForm.hagtags,"onUpdate:modelValue":t[2]||(t[2]=o=>e.dataForm.hagtags=o),class:"mt-[2px] max-w-[250px]",placeholder:"Chọn hagtag",multiple:""},{default:n(()=>[(l(!0),a(V,null,w(e.listHagTag,o=>(l(),b(F,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),s("div",G,[K,d(v,{modelValue:e.dataForm.is_notice,"onUpdate:modelValue":t[3]||(t[3]=o=>e.dataForm.is_notice=o),size:"large"},{default:n(()=>[d(f,{label:"1",size:"large",border:""},{default:n(()=>[p("Gửi thông báo")]),_:1}),d(f,{label:"0",size:"large",border:""},{default:n(()=>[p("Không gửi thông báo")]),_:1})]),_:1},8,["modelValue"])]),s("div",O,[X,s("div",A,[e.imageSelected?(l(),a("img",{key:0,src:e.imageSelected,alt:"",class:"rounded-[4px]"},null,8,J)):(l(),a("img",{key:1,src:e.dataForm.image,alt:"",class:"rounded-[4px]"},null,8,Q))]),s("div",{class:"cursor-pointer flex justify-center items-center w-[180px] rounded-[20px] bg-[#007bff] px-[10px] py-[4px] h-[32px] text-[14px] text-white mt-[8px]",onClick:t[5]||(t[5]=o=>this.$refs.file.click())},[s("input",{type:"file",ref:"file",accept:".jpg,.png,.bmp,.jpeg,.tif,.gif",onChange:t[4]||(t[4]=(...o)=>r.changeImage&&r.changeImage(...o)),hidden:""},null,544),W,p(" Upload hình ảnh ")]),e.errors.image?(l(),a("div",Y,m(e.errors.image[0]),1)):g("",!0)]),s("div",Z,[$,d(k,{class:"mt-[8px]",ref:"content",contentProp:e.dataForm.content},null,8,["contentProp"]),e.errors.content?(l(),a("div",tt,m(e.errors.content[0]),1)):g("",!0)])]),e.listCategory.length!=0?(l(),a("div",et,[st,s("div",ot,[d(v,{modelValue:e.categorySelect,"onUpdate:modelValue":t[6]||(t[6]=o=>e.categorySelect=o),size:"large"},{default:n(()=>[(l(!0),a(V,null,w(e.listCategory,o=>(l(),b(f,{label:o.slug,size:"large",border:""},{default:n(()=>[s("span",it,m(o.name),1),p(" : "),s("span",lt,m(o.value)+" %",1)]),_:2},1032,["label"]))),256))]),_:1},8,["modelValue"])])])):g("",!0)]),_:1},8,["modelValue"])}const gt=P(T,[["render",rt]]);export{gt as default};
