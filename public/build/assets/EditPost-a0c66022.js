import{i as z,j as f,G as U,k,l as d,o as l,c as m,w as a,a as t,b as n,e as p,t as g,h as x,g as b,F as v,f as c}from"./app-2a871929.js";import{C as P}from"./Ckeditor-fd58bb26.js";import{_ as D}from"./_plugin-vue_export-helper-c27b6911.js";const B={components:{Link:z,CkeditorPost:P},data(){return{id:"",dialogVisible:!1,imageSelected:"",dataForm:{},listHagTag:[],listCategory:"",categorySelect:"",errors:[]}},watch:{dialogVisible(i){i==!1&&(this.imageSelected="",this.$refs.file="",this.errors=[])}},methods:{async open(i){this.id=i,this.dialogVisible=!0,this.fetchData()},async fetchData(){await f.get(route("admin.posts.show",this.id)).then(i=>{this.dataForm=i.data.data,this.$refs.content.editorData=i.data.data.content}).catch(i=>{}),await f.get(route("list-hagtag")).then(i=>{this.listHagTag=i.data}).catch(i=>{})},cancel(){this.dialogVisible=!1},async changeImage(i){try{const e=i.target.files||i.dataTransfer.files;if(!e.length)return;if(e[0].size>5*1024*1024)return this.$message.warning(this.$i18n.t("File quá lớn, dung lượng tối đa cho phép 5MB")),!1;const u=e[0].name.substring(e[0].name.lastIndexOf(".")),h=[".png",".bmp",".jpeg",".tif",".gif",".jpg"];if(!h.find(s=>s===u))return this.$message.warning(this.$i18n.t("File sai định dạng. Cần thuộc các định dạng sau: ")+h.join(", ")),!1;this.dataForm.image=e[0],this.imageSelected=URL.createObjectURL(e[0])}catch(e){console.log("handleUploadContent",e)}},findCategory(){const i=U.service({lock:!0,text:"Đang tiến hành phân loại",background:"rgba(0, 0, 0, 0.7)"}),e=new FormData,u=this.$refs.content.editorData.replace(/(<([^>]+)>)/gi,"").replace(/&nbsp;/gi,"");e.append("content",u),f.post("http://127.0.0.1:5000/classify",e).then(h=>{this.listCategory=h.data,i.close()})},async editPost(){const i=new FormData;i.append("title",this.dataForm.title??""),i.append("description",this.dataForm.description??""),i.append("image",this.dataForm.image??""),i.append("content",this.$refs.content.editorData??""),i.append("hagtags",this.dataForm.hagtags??""),i.append("categorySlug",this.dataForm.categorySlug??""),i.append("is_popular",this.dataForm.is_popular??0),await f.post(route("admin.posts.update",this.dataForm.id),i).then(e=>{e.data.status==!1?k({showClose:!0,message:e.data.msg,type:"error"}):(k({showClose:!0,message:"Cập nhật bài viết thành công",type:"success"}),this.dialogVisible=!1,this.$emit("change-post"))}).catch(e=>{this.errors=e.response.data.errors})}}},N=t("div",{class:"text-center font-bold text-[18px]"}," Chỉnh sửa bài viết ",-1),T={class:"mx-[4px] mt-[42px]"},H={class:"mt-[18px] w-[100%]"},E=t("div",{class:"text-[16px] font-bold text-[#000]"},[c("Tiêu đề "),t("span",{class:"text-[red]"},"*")],-1),L={key:0,class:"mt-[5px] text-[#ff0000]"},I={class:"mt-[18px] w-[100%]"},M=t("div",{class:"text-[16px] font-bold text-[#000]"},"Mô tả ",-1),q={key:0,class:"mt-[5px] text-[#ff0000]"},K={class:"mt-[18px]"},O=t("div",{class:"text-[16px] font-bold text-[#000]"},"Hagtag",-1),R={class:"mt-[18px] w-[100%]"},G=t("div",{class:"text-[16px] font-bold text-[#000]"},[c("Hình ảnh "),t("span",{class:"text-[red]"},"*")],-1),X={class:"w-[280px] mt-[8px]"},A=t("i",{class:"bi bi-upload text-lg mr-[8px] text-white"},null,-1),J={key:0,class:"mt-[5px] text-[#ff0000]"},Q={class:"mt-[18px] w-[100%]"},W=t("div",{class:"text-[16px] font-bold text-[#000]"},[c("Nội dung "),t("span",{class:"text-[red]"},"*")],-1),Y={key:0,class:"mt-[5px] text-[#ff0000]"},Z={key:0,class:"mt-[18px]"},$=t("div",{class:"text-[16px] font-bold text-[#000]"},"Kết quả phân loại",-1),ee={class:"mt-[6px] mx-[12px]"},te={class:"font-bold"},se={class:"font-bold"},oe={class:"mt-[18px]"},ie=t("div",{class:"text-[16px] font-bold text-[#000] mb-[8px]"},"Bài viết nổi bật",-1),le={class:"mt-[18px]"},ae=t("div",{class:"text-[16px] font-bold text-[#000]"},"Chủ đề được phân loại",-1),ne={class:"pb-[12px] pt-[8px]"},re={class:"flex justify-end text-[14px] mr-[24px]"};function de(i,e,u,h,s,r){const y=d("el-input"),w=d("el-option"),F=d("el-select"),V=d("el-image"),j=d("ckeditor-post"),_=d("el-radio"),C=d("el-radio-group"),S=d("el-dialog");return l(),m(S,{modelValue:s.dialogVisible,"onUpdate:modelValue":e[10]||(e[10]=o=>s.dialogVisible=o),id:"edit-post",class:"bg-[#f4f1f8] max-h-[96%] overflow-y-scroll",width:"900px",style:{"margin-top":"14px !important"},"show-close":!0},{header:a(()=>[N]),footer:a(()=>[t("div",ne,[t("div",re,[t("div",{onClick:e[7]||(e[7]=(...o)=>r.cancel&&r.cancel(...o)),class:"cursor-pointer flex justify-center items-center w-[110px] rounded-[4px] bg-[#ffffff] py-[4px] h-[32px] text-[15px] text-black border border-[#7d7f92]"}," Hủy bỏ "),t("div",{class:"cursor-pointer flex justify-center items-center w-[110px] ml-[18px] rounded-[4px] bg-[#007bff] py-[4px] h-[32px] text-[15px] text-white",onClick:e[8]||(e[8]=(...o)=>r.findCategory&&r.findCategory(...o))}," Phân loại "),t("div",{class:"cursor-pointer flex justify-center items-center w-[110px] ml-[18px] rounded-[4px] bg-[#007bff] py-[4px] h-[32px] text-[15px] text-white",onClick:e[9]||(e[9]=(...o)=>r.editPost&&r.editPost(...o))}," Xác nhận ")])])]),default:a(()=>[t("div",T,[t("div",H,[E,n(y,{class:"mt-[2px]",modelValue:s.dataForm.title,"onUpdate:modelValue":e[0]||(e[0]=o=>s.dataForm.title=o),placeholder:"Nhập tiêu đề",clearable:""},null,8,["modelValue"]),s.errors.title?(l(),p("div",L,g(s.errors.title[0]),1)):x("",!0)]),t("div",I,[M,n(y,{class:"mt-[2px]",modelValue:s.dataForm.description,"onUpdate:modelValue":e[1]||(e[1]=o=>s.dataForm.description=o),placeholder:"Nhập mô tả",clearable:""},null,8,["modelValue"]),s.errors.description?(l(),p("div",q,g(s.errors.description[0]),1)):x("",!0)]),t("div",K,[O,n(F,{modelValue:s.dataForm.hagtags,"onUpdate:modelValue":e[2]||(e[2]=o=>s.dataForm.hagtags=o),class:"mt-[2px] max-w-[250px]",placeholder:"Chọn hagtag",multiple:""},{default:a(()=>[(l(!0),p(v,null,b(s.listHagTag,o=>(l(),m(w,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),t("div",R,[G,t("div",X,[s.imageSelected?(l(),m(V,{key:0,style:{width:"100%",height:"100%"},src:s.imageSelected,"zoom-rate":1.2,"preview-teleported":"true","hide-on-click-modal":"true","preview-src-list":[s.imageSelected],"initial-index":1,fit:"cover"},null,8,["src","zoom-rate","preview-src-list"])):(l(),m(V,{key:1,style:{width:"100%",height:"100%"},src:s.dataForm.image,"zoom-rate":1.2,"preview-teleported":"true","hide-on-click-modal":"true","preview-src-list":[s.dataForm.image],"initial-index":1,fit:"cover"},null,8,["src","zoom-rate","preview-src-list"]))]),t("div",{class:"cursor-pointer flex justify-center items-center w-[180px] rounded-[20px] bg-[#007bff] px-[10px] py-[4px] h-[32px] text-[14px] text-white mt-[8px]",onClick:e[4]||(e[4]=o=>this.$refs.file.click())},[t("input",{type:"file",ref:"file",accept:".jpg,.png,.bmp,.jpeg,.tif,.gif",onChange:e[3]||(e[3]=(...o)=>r.changeImage&&r.changeImage(...o)),hidden:""},null,544),A,c(" Upload hình ảnh ")]),s.errors.image?(l(),p("div",J,g(s.errors.image[0]),1)):x("",!0)]),t("div",Q,[W,n(j,{class:"mt-[8px]",ref:"content",contentProp:s.dataForm.content},null,8,["contentProp"]),s.errors.content?(l(),p("div",Y,g(s.errors.content[0]),1)):x("",!0)]),s.listCategory.length!=0?(l(),p("div",Z,[$,t("div",ee,[n(C,{size:"large",disabled:"false"},{default:a(()=>[(l(!0),p(v,null,b(s.listCategory,o=>(l(),m(_,{label:o.slug,size:"large",border:""},{default:a(()=>[t("span",te,g(o.name),1),c(" : "),t("span",se,g(o.value)+" %",1)]),_:2},1032,["label"]))),256))]),_:1})])])):x("",!0),t("div",oe,[ie,n(C,{modelValue:s.dataForm.is_popular,"onUpdate:modelValue":e[5]||(e[5]=o=>s.dataForm.is_popular=o),size:"large"},{default:a(()=>[n(_,{label:"1",size:"large",border:""},{default:a(()=>[c("Bài viết nổi bật")]),_:1}),n(_,{label:"0",size:"large",border:""},{default:a(()=>[c("Không phải bài viết nổi bật")]),_:1})]),_:1},8,["modelValue"])]),t("div",le,[ae,n(F,{modelValue:s.dataForm.categorySlug,"onUpdate:modelValue":e[6]||(e[6]=o=>s.dataForm.categorySlug=o),class:"mt-[2px] max-w-[250px]",placeholder:"Chọn chủ đề"},{default:a(()=>[(l(!0),p(v,null,b(this.$page.props.categories,o=>(l(),m(w,{label:o.name,value:o.slug},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])])])]),_:1},8,["modelValue"])}const ge=D(B,[["render",de]]);export{ge as default};
