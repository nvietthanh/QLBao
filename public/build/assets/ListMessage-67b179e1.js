import{A as F}from"./AppLayout-540a6a2e.js";import{i as A,l as g,o as c,c as _,w as v,a as t,b as y,e as n,F as p,g as h,t as d,n as x,h as w,m as j}from"./app-2a871929.js";import{h as f}from"./moment-fbc5633a.js";import{N as I}from"./Navigation-4a8d58ed.js";import{_ as D}from"./Dropdown-4ecace4f.js";import{_ as Y}from"./_plugin-vue_export-helper-c27b6911.js";const L={components:{AppLayout:F,Link:A,Navigation:I,Dropdown:D},props:{title:String,currentTab:{type:String,required:!0},backgroundColor:{type:String,default:"bg-[#fff]"}},data(){return{fileImageSelects:[],accountSearch:"",accountSelect:"",listAccount:{},listAccountSearch:{},accountSelect:"",listMessage:[],isChangeMessage:!1,seenMessage:!0,dataForm:{message:"",images:[]}}},created(){document.title="Danh sách cuộc trò chuyện",this.fetchData(),Echo.channel(`send-message.${this.$page.props.auth.account.id}`).listen("SendMessageEvent",i=>{const s=this.listAccount.findIndex(r=>r.account_id==i.account_send_id);let a=this.listAccount.find(r=>r.account_id==i.account_send_id);a.last_account_id=!0,a.last_message=i.message.content,a.status=0,a.last_message_time=f().format("YYYY/MM/DD H:mm:ss"),this.listAccount.splice(s,1),this.listAccount.unshift(a),i.account_send_id==this.accountSelect.account_id&&(this.listMessage.unshift(i.message),this.accountSelect.is_account_send=1,i.message.status?this.seenMessage=!0:this.seenMessage=!1)}),Echo.channel(`change-status-message.${this.$page.props.auth.account.id}`).listen("ChangeStatusMessageEvent",i=>{let s=this.listAccount.find(a=>a.account_id==i.account_send_id);s&&(s=i.status),i.account_send_id==this.accountSelect.account_id&&(this.accountSelect.status=i.status)})},methods:{moment:f,async fetchData(){await axios.get(route("list-account-message")).then(i=>{this.listAccount=i.data.data}).catch(()=>{}),this.$page.props.account_message_id&&(this.listAccount.forEach(i=>{if(i.account_id==this.$page.props.account_message_id){this.accountSelect=i;return}}),this.accountSelect?this.fetchListMessage():this.accountSelect=this.$page.props.accountSelect)},async fetchListAccount(){await axios.get(route("list-account-message")).then(i=>{this.listAccount=i.data.data}).catch(()=>{})},async fetchListMessage(){await axios.get(route("list-message",this.accountSelect.account_id)).then(i=>{this.listMessage=i.data.data.reverse(),this.listMessage.length>0&&this.accountSelect.status==0&&this.accountSelect.last_account_id?this.seenMessage=!1:this.seenMessage=!0}).catch(()=>{})},searchAccount(){const i={keyword:this.accountSearch};axios.get(route("search-account-message",i)).then(s=>{this.listAccountSearch=s.data}).catch(s=>{this.errors=s.response.data.errors})},sendMessage(){if(this.dataForm.message||this.dataForm.images.length>0){this.accountSelect.is_account_send=0,this.accountSelect.status=0;const i=new FormData;i.append("id",this.accountSelect.account_id),i.append("message",this.dataForm.message);for(let r of this.dataForm.images)i.append("images[]",r);const s={account_receive_id:this.accountSelect.id,account_receive_image:this.accountSelect.image,account_receive_name:this.accountSelect.name,account_send_id:this.$page.props.auth.account.id,account_send_image:this.$page.props.auth.account.id,account_send_name:this.$page.props.auth.account.first_name+" "+this.$page.props.auth.account.last_name,content:this.dataForm.message,created_at:f().format("YYYY/MM/DD H:mm:ss"),file:JSON.parse(JSON.stringify(this.fileImageSelects)),status:!1,type:this.dataForm.message?0:1};this.listMessage.unshift(s),this.dataForm.message="",this.dataForm.images=[],this.fileImageSelects=[],this.isChangeMessage=!1,this.accountSelect.status=-1,this.accountSelect.last_account_id=!1,this.accountSelect.last_message_time=f().format("YYYY/MM/DD H:mm:ss");let a=this.listAccount.find(r=>r.account_id==this.accountSelect.account_id);a||(a=this.listAccount.append(this.accountSelect)),a.last_message=s.content,a.last_account_id=!1,a.last_message_time=f().format("YYYY/MM/DD H:mm:ss"),a.status=-1,axios.post(route("send-message"),i).then(r=>{this.accountSelect.status=0,a.status=0}).catch(r=>{this.errors=r.response.data.errors})}},changeStatus(){const i=this.listMessage[0];if(i&&i.account_receive_id==this.$page.props.auth.account.id&&i.status==0){this.seenMessage=!0;let s=this.listAccount.find(a=>a.account_id==this.accountSelect.account_id);s&&(s.status=1),axios.get(route("change-status-message",this.accountSelect.account_id))}},changeInput(){this.dataForm.message.length>0?this.isChangeMessage=!0:this.isChangeMessage=!1,this.changeStatus()},async changeImage(i){try{const s=i.target.files||i.dataTransfer.files;if(!s.length)return;for(let a of s){const r=a.name.substring(a.name.lastIndexOf(".")),o=[".png",".bmp",".jpeg",".tif",".gif",".jpg"];if(!o.find(l=>l===r))return this.$message.warning(this.$i18n.t("File sai định dạng. Cần thuộc các định dạng sau: ")+o.join(", ")),!1;this.dataForm.images.push(a),this.fileImageSelects.push(URL.createObjectURL(a))}}catch(s){console.log("handleUploadContent",s)}},deleteImageSelect(i){this.fileImageSelects.shift(i),this.dataForm.images.shift(i)},convertTime(i){const s=f(),a=f(i);return s.diff(a,"years")>0?`${s.diff(a,"years")} năm trước`:s.diff(a,"months")>0?`${s.diff(a,"months")} tháng trước`:s.diff(a,"days")>0?`${s.diff(a,"days")} ngày trước`:s.diff(a,"hours")>0?`${s.diff(a,"hours")} giờ trước`:s.diff(a,"minutes")>0?`${s.diff(a,"minutes")} phút trước`:s.diff(a,"seconds")>0?`${s.diff(a,"seconds")} giây trước`:"1 giây trước"}}},z={class:"bg-[#fff] flex w-[100%] box-shadow"},E={class:"min-w-[380px] w-[380px] border-r-[2px] py-[12px]"},V={class:"px-[24px] w-[100%]"},N=t("div",{class:"font-bold mt-[8px]"},"Cuộc trò chuyện",-1),K={class:"border-b-[2px] mt-[12px] pb-[18px] w-[100%] search"},T={class:"px-[2px] w-[100%] py-[6px]"},B={key:0,class:"w-[100%] text-center text-[14px] py-[12px]"},U={key:1,class:"w-[100%] max-h-[200px] overflow-y-scroll"},H={class:"flex items-center hover:bg-[#f1f3f6] py-[8px] px-[12px]"},O=["src"],J={key:1,class:"bg-[#5c6bc0] min-w-[28px] w-[28px] h-[28px] border-[1px] rounded-[50%] flex justify-center items-center"},R={class:"text-[#fff] text-[18px]"},q={class:"ml-[10px]"},G={class:"text-[14px] font-bold"},P={class:"pl-[24px]"},Q={class:"overflow-y-scroll max-h-[480px] h-[480px] mt-[8px]"},W={class:"flex items-center"},X=["src"],Z={key:1,class:"bg-[#5c6bc0] min-w-[48px] w-[48px] h-[48px] border-[1px] rounded-[50%] flex justify-center items-center"},$={class:"text-[#fff] text-[18px]"},ee={class:"ml-[10px]"},te={class:"text-[14px] font-bold"},se={class:"text-[13px] flex"},ce={class:"message-content"},ie={class:"ml-[12px] text-[12px]"},ne={key:0,class:"ml-[12px] text-[20px] min-w-[10px]"},ae={key:0,class:"ml-[12px] min-w-[10px] h-[10px] bg-[#0099FF] rounded-[50%]"},oe={class:"flex-auto"},le={class:"flex items-center"},re=["src"],de={key:1,class:"bg-[#5c6bc0] min-w-[42px] w-[42px] h-[42px] border-[1px] rounded-[50%] flex justify-center items-center"},ue={class:"text-[#fff] text-[18px]"},pe={class:"ml-[10px]"},he={class:"text-[15px] font-bold"},_e=t("div",{class:"text-[12px]"},"Đang hoạt động",-1),xe={key:0,class:"flex justify-end text-[12px] mt-[2px]"},fe={key:0,class:"flex justify-end items-end text-white mt-[4px]"},me={class:"text-[15px] ml-[8px] bg-[#3578E5] max-w-[400px] py-[8px] px-[18px] rounded-[8px]"},ge={key:1,class:"flex justify-end items-end mt-[4px]"},ve={key:0,class:"grid grid-cols-3 gap-1 w-[400px]"},ye={key:1,class:"grid grid-cols-2 gap-1 w-[400px]"},we={key:2,class:"w-[280px]"},be={key:1,class:"flex items-end"},Se=["src"],ke={key:1,class:"bg-[#5c6bc0] min-w-[32px] w-[32px] h-[32px] border-[1px] rounded-[50%] flex justify-center items-center"},Me={class:"text-[#fff] text-[13px]"},Ce={key:2,class:"mt-[4px]"},Fe={class:"text-[15px] ml-[8px] bg-[#e9ecef] max-w-[400px] py-[8px] px-[18px] rounded-[8px]"},Ae={key:3,class:"mt-[4px]"},je={class:"ml-[8px]"},Ie={key:0,class:"grid grid-cols-3 gap-1 w-[400px]"},De={key:1,class:"grid grid-cols-2 gap-1 w-[400px]"},Ye={key:2,class:"w-[280px]"},Le={class:"w-[100%]"},ze={key:0,class:"flex bg-[#e9ecef] pt-[12px] px-[12px] mx-[18px] rounded-t-[8px]"},Ee=t("i",{class:"bi bi-plus-lg"},null,-1),Ve=[Ee],Ne={class:"mr-[12px] min-w-[70px] w-[70px] h-[70px] relative object-cover"},Ke=["src"],Te=["onClick"],Be=t("i",{class:"bi bi-x-lg"},null,-1),Ue=[Be],He={class:"mx-[18px] flex w-[100%] justify-between items-center"},Oe={class:"flex justify-between"},Je=t("span",{class:"text-[20px] cursor-pointer active:scale-[97%]"},[t("i",{class:"bi bi-plus-circle"})],-1),Re=t("i",{class:"bi bi-image"},null,-1),qe=t("i",{class:"bi bi-file-earmark-plus"},null,-1),Ge=[qe],Pe=t("i",{class:"bi bi-plus-circle"},null,-1),Qe=[Pe],We={class:"flex-auto mx-[18px]"},Xe=t("i",{class:"bi bi-send-fill"},null,-1),Ze=[Xe],$e={key:1,class:"w-[100%] h-[100%] flex justify-center items-center"},et=t("b",null,"Không có cuộc hội thoại nào, hãy chọn cuộc hội thoại",-1),tt=[et];function st(i,s,a,r,o,l){const b=g("el-input"),S=g("Link"),M=g("Dropdown"),m=g("el-image"),C=g("AppLayout");return c(),_(C,{"current-tab":"main-full"},{"main-full":v(()=>[t("div",z,[t("div",E,[t("div",V,[N,t("div",K,[y(M,{align:"left",class:"right-0 w-[100%] text-[#000]",contentClasses:[a.backgroundColor]},{trigger:v(()=>[y(b,{onKeyup:s[0]||(s[0]=e=>l.searchAccount()),modelValue:o.accountSearch,"onUpdate:modelValue":s[1]||(s[1]=e=>o.accountSearch=e),placeholder:"Tìm cuộc trò chuyện",class:"w-[100%]"},null,8,["modelValue"])]),content:v(()=>[t("div",T,[o.listAccountSearch.length==0?(c(),n("div",B," Không có dữ liệu ")):(c(),n("div",U,[(c(!0),n(p,null,h(o.listAccountSearch,e=>(c(),_(S,{href:i.route("user.list-message",e.account_id??1)},{default:v(()=>[t("div",H,[e.account_image?(c(),n("img",{key:0,src:e.account_image,alt:"",class:"w-[28px] h-[28px] rounded-[50%]"},null,8,O)):(c(),n("div",J,[t("span",R,d(e.account_name[0]),1)])),t("div",q,[t("div",G,d(e.account_name),1)])])]),_:2},1032,["href"]))),256))]))])]),_:1},8,["contentClasses"])])]),t("div",P,[t("div",Q,[(c(!0),n(p,null,h(o.listAccount,e=>(c(),_(S,{href:i.route("user.list-message",e.account_id)},{default:v(()=>[t("div",{class:x(["flex items-center justify-between cursor-pointer rounded-[4px] px-[8px] py-[12px] active:bg-[#d4d5d6]",{"bg-[#f1f3f6]":e.account_id==o.accountSelect.account_id}])},[t("div",W,[e.account_image?(c(),n("img",{key:0,src:e.account_image,alt:"",class:"w-[48px] h-[48px] rounded-[50%]"},null,8,X)):(c(),n("div",Z,[t("span",$,d(e.account_name[0]),1)])),t("div",ee,[t("div",te,d(e.account_name),1),t("div",se,[t("span",ce,[t("span",{class:x({"font-bold":e.last_account_id&&!e.status})},d(e.last_account_id?"":"Bạn: ")+d(e.last_message),3)]),t("span",ie,d(l.convertTime(e.last_message_time)),1)])])]),e.status==-1?(c(),n("div",ne,"...")):(c(),n(p,{key:1},[e.last_account_id&&!e.status?(c(),n("div",ae)):w("",!0)],64))],2)]),_:2},1032,["href"]))),256))])])]),t("div",oe,[o.accountSelect?(c(),n(p,{key:0},[t("div",{class:x(["flex items-center border-b-[2px] h-[62px] px-[12px]",{" bg-[#3578E5] text-white":!o.seenMessage}])},[t("div",le,[o.accountSelect.account_image?(c(),n("img",{key:0,src:o.accountSelect.account_image,alt:"",class:"w-[42px] h-[42px] rounded-[50%]"},null,8,re)):(c(),n("div",de,[t("span",ue,d(o.accountSelect.account_name[0]),1)])),t("span",pe,[t("div",he,d(o.accountSelect.account_name),1),_e])])],2),t("div",{class:x(["overflow-y-scroll px-[12px] pb-[8px] flex flex-col-reverse",{"border-r-[2px] border-r-[#3578E5]":!o.seenMessage,"h-[498px] max-h-[498px]":o.fileImageSelects.length==0,"h-[415px] max-h-[415px]":o.fileImageSelects.length>0}]),onClick:s[2]||(s[2]=(...e)=>l.changeStatus&&l.changeStatus(...e))},[o.accountSelect.last_account_id?w("",!0):(c(),n("div",xe,d(o.accountSelect.status==-1?"Đang gửi":o.accountSelect.status?"Đã xem":"Đã gửi"),1)),(c(!0),n(p,null,h(o.listMessage,(e,k)=>(c(),n(p,null,[e.account_send_id==this.$page.props.auth.account.id?(c(),n(p,{key:0},[e.type==0?(c(),n("div",fe,[t("div",me,d(e.content),1)])):e.type==1?(c(),n("div",ge,[e.file.length>=3?(c(),n("div",ve,[(c(!0),n(p,null,h(e.file,u=>(c(),_(m,{style:{width:"100%",height:"120px","border-radius":"8px"},src:u,"zoom-rate":1.2,"preview-teleported":"true","hide-on-click-modal":"true","preview-src-list":[u],"initial-index":1,fit:"cover"},null,8,["src","zoom-rate","preview-src-list"]))),256))])):e.file.length==2?(c(),n("div",ye,[(c(!0),n(p,null,h(e.file,u=>(c(),_(m,{style:{width:"100%",height:"180px","border-radius":"8px"},src:u,"zoom-rate":1.2,"preview-teleported":"true","hide-on-click-modal":"true","preview-src-list":[u],"initial-index":1,fit:"cover"},null,8,["src","zoom-rate","preview-src-list"]))),256))])):(c(),n("div",we,[y(m,{style:{width:"100%",height:"180px","border-radius":"8px"},src:e.file[0],"zoom-rate":1.2,"preview-teleported":"true","hide-on-click-modal":"true","preview-src-list":[e.file[0]],"initial-index":1,fit:"cover"},null,8,["src","zoom-rate","preview-src-list"])]))])):w("",!0)],64)):(c(),n("div",be,[e.account_send_image?(c(),n("img",{key:0,src:e.account_send_image,alt:"",class:"w-[32px] h-[32px] rounded-[50%]"},null,8,Se)):(c(),n("div",ke,[t("span",Me,d(e.account_send_name[0]),1)])),e.type==0?(c(),n("div",Ce,[t("div",Fe,d(e.content),1)])):e.type==1?(c(),n("div",Ae,[t("div",je,[e.file.length==3?(c(),n("div",Ie,[(c(!0),n(p,null,h(e.file,u=>(c(),_(m,{style:{width:"100%",height:"120px","border-radius":"8px"},src:u,"zoom-rate":1.2,"preview-teleported":"true","hide-on-click-modal":"true","preview-src-list":[u],"initial-index":1,fit:"cover"},null,8,["src","zoom-rate","preview-src-list"]))),256))])):e.file.length==2?(c(),n("div",De,[(c(!0),n(p,null,h(e.file,u=>(c(),_(m,{style:{width:"100%",height:"180px","border-radius":"8px"},src:u,"zoom-rate":1.2,"preview-teleported":"true","hide-on-click-modal":"true","preview-src-list":[u],"initial-index":1,fit:"cover"},null,8,["src","zoom-rate","preview-src-list"]))),256))])):(c(),n("div",Ye,[y(m,{style:{width:"100%",height:"180px","border-radius":"8px"},src:e.file[0],"zoom-rate":1.2,"preview-teleported":"true","hide-on-click-modal":"true","preview-src-list":[e.file[0]],"initial-index":1,fit:"cover"},null,8,["src","zoom-rate","preview-src-list"])]))])])):w("",!0)]))],64))),256))],2),t("div",Le,[o.fileImageSelects.length>0?(c(),n("div",ze,[t("div",{class:"mr-[12px] min-w-[70px] w-[70px] h-[70px] leading-[70px] text-center bg-[#fff] rounded-[8px] hover:bg-[#f8f9fa] cursor-pointer",onClick:s[3]||(s[3]=e=>this.$refs.file.click())},Ve),(c(!0),n(p,null,h(o.fileImageSelects,(e,k)=>(c(),n("div",Ne,[t("img",{src:e,alt:"",class:"rounded-[8px] w-[100%] h-[100%]"},null,8,Ke),t("span",{class:"absolute top-[-4px] right-[-4px] bg-[#fff] rounded-[50%] text-[12px] w-[21px] h-[21px] leading-[23px] text-center border-[#ced4da] border-[1px] hover:bg-[#e9ecef] cursor-pointer",onClick:u=>l.deleteImageSelect(k)},Ue,8,Te)]))),256))])):w("",!0),t("div",{class:"flex border-t-[1px] text-[#3578E5] py-[8px]",onClick:s[8]||(s[8]=(...e)=>l.changeStatus&&l.changeStatus(...e))},[t("div",He,[t("div",Oe,[Je,t("span",{class:x(["ml-[10px] text-[20px] cursor-pointer active:scale-[97%]",{"d-none":this.isChangeMessage}]),onClick:s[5]||(s[5]=e=>this.$refs.file.click())},[Re,t("input",{ref:"file",type:"file",accept:".jpg,.png,.bmp,.jpeg,.tif,.gif",multiple:"",onChange:s[4]||(s[4]=(...e)=>l.changeImage&&l.changeImage(...e)),hidden:""},null,544)],2),t("span",{class:x(["ml-[10px] text-[20px] cursor-pointer active:scale-[97%]",{"d-none":this.isChangeMessage}])},Ge,2),t("span",{class:x(["ml-[10px] text-[20px] cursor-pointer active:scale-[97%]",{"d-none":this.isChangeMessage}])},Qe,2)]),t("div",We,[y(b,{ref:"message",onKeyup:[j(l.sendMessage,["enter"]),l.changeInput],modelValue:o.dataForm.message,"onUpdate:modelValue":s[6]||(s[6]=e=>o.dataForm.message=e),placeholder:"Nhập nội dung tin nhắn"},null,8,["onKeyup","modelValue"])]),t("span",{class:"text-[24px] cursor-pointer",onClick:s[7]||(s[7]=(...e)=>l.sendMessage&&l.sendMessage(...e))},Ze)])])])],64)):(c(),n("div",$e,tt))])])]),_:1})}const rt=Y(L,[["render",st]]);export{rt as default};
